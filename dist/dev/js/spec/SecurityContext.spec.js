var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
(function (factory) {
    if (typeof module === 'object' && typeof module.exports === 'object') {
        var v = factory(require, exports); if (v !== undefined) module.exports = v;
    }
    else if (typeof define === 'function' && define.amd) {
        define(["require", "exports", '../src/SecurityContext', '../src/Identities/Identity', '../src/SecurityContextEncodedTokenInitializer'], factory);
    }
})(function (require, exports) {
    "use strict";
    /// <reference path='../../typings/main.d.ts' />
    var SecurityContext_1 = require('../src/SecurityContext');
    var Identity_1 = require('../src/Identities/Identity');
    //import {IdentityFactory} from '../src/Identities/IdentityFactory';
    var SecurityContextEncodedTokenInitializer_1 = require('../src/SecurityContextEncodedTokenInitializer');
    describe('SecurityContext', function () {
        var accessToken = "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6ImEzck1VZ01Gdjl0UGNsTGE2eUYzekFrZnF1RSIsIng1dCI6ImEzck1VZ01Gdjl0UGNsTGE2eUYzekFrZnF1RSJ9.eyJpc3MiOiJodHRwczovL3BqbXRzdHMvIiwiYXVkIjoiaHR0cHM6Ly9wam10c3RzL3Jlc291cmNlcyIsImV4cCI6MTQ2MTg4NjIzNSwibmJmIjoxNDYxODgyNjM1LCJjbGllbnRfaWQiOiIyMzgwIiwic2NvcGUiOlsib3BlbmlkIiwicHJvZmlsZSIsImVtYWlsIiwicGptdF9wcm9maWxlIiwicGVybWlzc2FvXzIzODAiXSwic3ViIjoiMTY4NDMiLCJhdXRoX3RpbWUiOjE0NjExNjQ5MzIsImlkcCI6Imlkc3J2IiwicGVybWlzc2FvfDIzODA6RGFzaGJvYXJkIjoiQWNlc3NvIiwicGVybWlzc2FvfDIzODA6RGFzaGJvYXJkLkdyYWZpY29zIjoiQWNlc3NvIiwicGVybWlzc2FvfDIzODA6RGFzaGJvYXJkLkdyYWZpY29zLkRpdmVyc29zIjoiQWNlc3NvIiwicGVybWlzc2FvfDIzODA6RGFzaGJvYXJkLkdyYWZpY29zLlNvYnJlIjoiQWNlc3NvIiwicGVybWlzc2FvfDIzODA6RGFzaGJvYXJkLlJlbGF0b3Jpby5SZWxhdG9yaW9DcmlhY2FvIjoiQWNlc3NvIiwicGVybWlzc2FvfDIzODA6RGFzaGJvYXJkLlJlbGF0b3Jpb3MuUmVsYXRvcmlvQWNlc3NvcyI6WyJBY2Vzc28iLCJBbHRlcmFyIiwiRXhjbHVpciIsIk5vdm8iXSwicGVybWlzc2FvfDIzODA6SG9tZSI6IkFjZXNzbyIsInBlcm1pc3Nhb3wyMzgwOk5vdGljaWFzIjoiQWNlc3NvIiwicGVybWlzc2FvfDIzODA6UmVsYXRvcmlvcyI6IkFjZXNzbyIsImFtciI6WyJwYXNzd29yZCJdfQ.Eg-bdPAHKMIDlVMiGNJxEJ9zqth2UmU-k0Ek1BIthC6WKnfyFOQ7EQXIbQGBrLhm4CHr_siwrgThAL5Nq3GJAo0_wxfjgdgt965FHZLO0Xa-QRTvfWdwCU7_jHYjlwuyJ8IDiEpQf6y6eeUIMxRI0JZa-aIrt5MtMCrMMecTdURXF91bXBFdNDJSGLpqrf687HuzUCHrrznBr6wO-5-5Y24rnpTbEclS9KDJYuTZoBQA6-Tkcy_XBHg4c1whwwORf9Nfv1c8_V6ZjML1eiqdlK7MDjqmsZbAZkScrJzZmxpoBMkvAMDIhkmB8ZVsGkrYICqtrAR6BIuTk2aK3z8low";
        //const accessTokenJSON:any = JSON.parse(`{"iss":"https://pjmtsts/","aud":"https://pjmtsts/resources","exp":1462403582,"nbf":1462399982,"client_id":"2380","scope":["openid","profile","pjmt_profile","email","permissao_2380"],"sub":"16843","auth_time":1462397042,"idp":"idsrv","permissao|2380:Dashboard":"Acesso","permissao|2380:Dashboard.Graficos":"Acesso","permissao|2380:Dashboard.Graficos.Diversos":"Acesso","permissao|2380:Dashboard.Graficos.Sobre":"Acesso","permissao|2380:Dashboard.Relatorio.RelatorioCriacao":"Acesso","permissao|2380:Dashboard.Relatorios.RelatorioAcessos":["Acesso","Alterar","Excluir","Novo"],"permissao|2380:Home":"Acesso","permissao|2380:Noticias":"Acesso","permissao|2380:Relatorios":"Acesso","amr":["password"]}`);
        var identityToken = "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6ImEzck1VZ01Gdjl0UGNsTGE2eUYzekFrZnF1RSIsIng1dCI6ImEzck1VZ01Gdjl0UGNsTGE2eUYzekFrZnF1RSJ9.eyJpc3MiOiJodHRwczovL3BqbXRzdHMvIiwiYXVkIjoiMjM4MCIsImV4cCI6MTQ2MTg4MjkzNSwibmJmIjoxNDYxODgyNjM1LCJub25jZSI6IjEyMjMwMjA2NTU5NDkyMDgiLCJpYXQiOjE0NjE4ODI2MzUsImF0X2hhc2giOiIzeV9iSi1oZEZiMjE3VHNpQUVpVnZ3IiwiY19oYXNoIjoibGhMRDFOaTNkcms0aEJKYXBQRUpaQSIsInNpZCI6IjNkMGQzNWYxNGFjYWQ3MzEyM2E2Y2FmMGU5NTY5NGIzIiwic3ViIjoiMTY4NDMiLCJhdXRoX3RpbWUiOjE0NjExNjQ5MzIsImlkcCI6Imlkc3J2IiwiYW1yIjpbInBhc3N3b3JkIl19.hS9vFGcUq6j3CBRsUDm2RG0zwyNbdRijN1L_f7EmX4d5o8Wxh9RaWxPmYUSAGt211lrnp1W0zm7HfWqOu3szJnhCWKfX_P9CYuc-3NyWXxL9iMZM07lzweunJeYrWM99KCWT9il_ptR3cvNBEZPBBHBmzQ5EPbHqMga35U3U0rHTuC1134qvDFE-2YoGyNXxP5KD-pyVlx0hPXOsfv9xYfKr9C31eEMqyyavZWpmiH8Ywz1vlJTMdX6Y9Gm7599Ojqe66mRAaDX7_rf8kecgvkSZD0uozHPGIX-Y8ORPS83AHXTOFOAXoO3hvxnJJ6iN1oVJSzWVsI59VFbvMIawCw";
        beforeEach(function () {
            SecurityContext_1.SecurityContext.Reset();
        });
        it('Init should instantiate a User', function () {
            var securityContextInitializer = new SecurityContextEncodedTokenInitializer_1.SecurityContextEncodedTokenInitializer([accessToken, identityToken]);
            SecurityContext_1.SecurityContext.Current.Init(securityContextInitializer);
            //SecurityContext.Current.User.permissoes.filter((permissao) => permissao.permissoes.some((perm) => perm == ""));
            expect(SecurityContext_1.SecurityContext.Current.Principal).toBeDefined();
        });
        it('Init should have a User authenticated', function () {
            var securityContextInitializer = new SecurityContextEncodedTokenInitializer_1.SecurityContextEncodedTokenInitializer([accessToken, identityToken]);
            SecurityContext_1.SecurityContext.Current.Init(securityContextInitializer);
            expect(SecurityContext_1.SecurityContext.Current.Principal.IsAuthenticated).toBeTruthy();
        });
        it('User should have client_id', function () {
            var securityContextInitializer = new SecurityContextEncodedTokenInitializer_1.SecurityContextEncodedTokenInitializer([accessToken, identityToken]);
            SecurityContext_1.SecurityContext.Current.Init(securityContextInitializer);
            var client_id = SecurityContext_1.SecurityContext.Current.Principal.Identity.findFirst('client_id');
            expect(client_id).toBe('2380');
        });
        it('User should not be authenticated', function () {
            expect(SecurityContext_1.SecurityContext.Current.Principal.IsAuthenticated).toBe(false);
        });
        it('Should let a Customized Identity be set', function () {
            var IdentityCustomized = (function (_super) {
                __extends(IdentityCustomized, _super);
                function IdentityCustomized() {
                    _super.apply(this, arguments);
                }
                Object.defineProperty(IdentityCustomized.prototype, "ClientId", {
                    get: function () {
                        var value = this.findFirst('client_id');
                        return value;
                    },
                    enumerable: true,
                    configurable: true
                });
                return IdentityCustomized;
            }(Identity_1.Identity));
            // let customizedIdentity :IdentityCustomized = IdentityFactory.Create(IdentityCustomized, [accessTokenJSON]);
            // SecurityContext.Current.Principal.Identity = customizedIdentity;
            var customizedIdentity = new IdentityCustomized([{ key: 'client_id', value: '2380' }]);
            SecurityContext_1.SecurityContext.Current.Principal.Identity = customizedIdentity;
            console.log(customizedIdentity);
            expect(customizedIdentity.ClientId).toBeTruthy('2380');
        });
    });
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNwZWMvU2VjdXJpdHlDb250ZXh0LnNwZWMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7SUFBQSxnREFBZ0Q7SUFDaEQsZ0NBQThCLHdCQUF3QixDQUFDLENBQUE7SUFDdkQseUJBQXVCLDRCQUE0QixDQUFDLENBQUE7SUFDcEQsb0VBQW9FO0lBQ3BFLHVEQUFxRCwrQ0FBK0MsQ0FBQyxDQUFBO0lBRXJHLFFBQVEsQ0FBQyxpQkFBaUIsRUFBRTtRQUV4QixJQUFNLFdBQVcsR0FBVSxnNENBQWc0QyxDQUFDO1FBRXg1QyxzdUJBQXN1QjtRQUcxdUIsSUFBTSxhQUFhLEdBQVUsMDJCQUEwMkIsQ0FBQztRQUcxNEIsVUFBVSxDQUFDO1lBQ1AsaUNBQWUsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUMxQixDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxnQ0FBZ0MsRUFBRTtZQUVqQyxJQUFJLDBCQUEwQixHQUFHLElBQUksK0VBQXNDLENBQUMsQ0FBQyxXQUFXLEVBQUUsYUFBYSxDQUFDLENBQUMsQ0FBQztZQUMxRyxpQ0FBZSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsMEJBQTBCLENBQUMsQ0FBQztZQUV6RCxpSEFBaUg7WUFFakgsTUFBTSxDQUFDLGlDQUFlLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBRTVELENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHVDQUF1QyxFQUFFO1lBRXhDLElBQUksMEJBQTBCLEdBQUcsSUFBSSwrRUFBc0MsQ0FBQyxDQUFDLFdBQVcsRUFBRSxhQUFhLENBQUMsQ0FBQyxDQUFDO1lBQzFHLGlDQUFlLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO1lBRXpELE1BQU0sQ0FBQyxpQ0FBZSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsZUFBZSxDQUFDLENBQUMsVUFBVSxFQUFFLENBQUM7UUFFM0UsQ0FBQyxDQUFDLENBQUM7UUFHSCxFQUFFLENBQUMsNEJBQTRCLEVBQUU7WUFFN0IsSUFBSSwwQkFBMEIsR0FBRyxJQUFJLCtFQUFzQyxDQUFDLENBQUMsV0FBVyxFQUFFLGFBQWEsQ0FBQyxDQUFDLENBQUM7WUFDMUcsaUNBQWUsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLDBCQUEwQixDQUFDLENBQUM7WUFFekQsSUFBSSxTQUFTLEdBQWMsaUNBQWUsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLFFBQVMsQ0FBQyxTQUFTLENBQVMsV0FBVyxDQUFDLENBQUM7WUFFdEcsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUVuQyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxrQ0FBa0MsRUFBRTtZQUVuQyxNQUFNLENBQUMsaUNBQWUsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLGVBQWUsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUUxRSxDQUFDLENBQUMsQ0FBQztRQUdILEVBQUUsQ0FBQyx5Q0FBeUMsRUFBRTtZQUUxQztnQkFBaUMsc0NBQVE7Z0JBQXpDO29CQUFpQyw4QkFBUTtnQkFPekMsQ0FBQztnQkFMRyxzQkFBVyx3Q0FBUTt5QkFBbkI7d0JBRUksSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBUyxXQUFXLENBQUMsQ0FBQzt3QkFDaEQsTUFBTSxDQUFDLEtBQUssQ0FBQztvQkFDakIsQ0FBQzs7O21CQUFBO2dCQUNMLHlCQUFDO1lBQUQsQ0FQQSxBQU9DLENBUGdDLG1CQUFRLEdBT3hDO1lBRUQsOEdBQThHO1lBQzlHLG1FQUFtRTtZQUVuRSxJQUFJLGtCQUFrQixHQUF1QixJQUFJLGtCQUFrQixDQUFDLENBQUMsRUFBRSxHQUFHLEVBQUUsV0FBVyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDM0csaUNBQWUsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLFFBQVEsR0FBRyxrQkFBa0IsQ0FBQztZQUVoRSxPQUFPLENBQUMsR0FBRyxDQUFDLGtCQUFrQixDQUFDLENBQUM7WUFFaEMsTUFBTSxDQUFDLGtCQUFrQixDQUFDLFFBQVEsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUUzRCxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDIiwiZmlsZSI6InNwZWMvU2VjdXJpdHlDb250ZXh0LnNwZWMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSBwYXRoPScuLi8uLi90eXBpbmdzL21haW4uZC50cycgLz5cclxuaW1wb3J0IHtTZWN1cml0eUNvbnRleHR9IGZyb20gJy4uL3NyYy9TZWN1cml0eUNvbnRleHQnO1xyXG5pbXBvcnQge0lkZW50aXR5fSBmcm9tICcuLi9zcmMvSWRlbnRpdGllcy9JZGVudGl0eSc7XHJcbi8vaW1wb3J0IHtJZGVudGl0eUZhY3Rvcnl9IGZyb20gJy4uL3NyYy9JZGVudGl0aWVzL0lkZW50aXR5RmFjdG9yeSc7XHJcbmltcG9ydCB7U2VjdXJpdHlDb250ZXh0RW5jb2RlZFRva2VuSW5pdGlhbGl6ZXJ9IGZyb20gJy4uL3NyYy9TZWN1cml0eUNvbnRleHRFbmNvZGVkVG9rZW5Jbml0aWFsaXplcic7XHJcblxyXG5kZXNjcmliZSgnU2VjdXJpdHlDb250ZXh0JywgKCkgPT4ge1xyXG4gICAgXHJcbiAgICBjb25zdCBhY2Nlc3NUb2tlbjpzdHJpbmcgPSBcImV5SjBlWEFpT2lKS1YxUWlMQ0poYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1FemNrMVZaMDFHZGpsMFVHTnNUR0UyZVVZemVrRnJabkYxUlNJc0luZzFkQ0k2SW1FemNrMVZaMDFHZGpsMFVHTnNUR0UyZVVZemVrRnJabkYxUlNKOS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkwzQnFiWFJ6ZEhNdklpd2lZWFZrSWpvaWFIUjBjSE02THk5d2FtMTBjM1J6TDNKbGMyOTFjbU5sY3lJc0ltVjRjQ0k2TVRRMk1UZzROakl6TlN3aWJtSm1Jam94TkRZeE9EZ3lOak0xTENKamJHbGxiblJmYVdRaU9pSXlNemd3SWl3aWMyTnZjR1VpT2xzaWIzQmxibWxrSWl3aWNISnZabWxzWlNJc0ltVnRZV2xzSWl3aWNHcHRkRjl3Y205bWFXeGxJaXdpY0dWeWJXbHpjMkZ2WHpJek9EQWlYU3dpYzNWaUlqb2lNVFk0TkRNaUxDSmhkWFJvWDNScGJXVWlPakUwTmpFeE5qUTVNeklzSW1sa2NDSTZJbWxrYzNKMklpd2ljR1Z5YldsemMyRnZmREl6T0RBNlJHRnphR0p2WVhKa0lqb2lRV05sYzNOdklpd2ljR1Z5YldsemMyRnZmREl6T0RBNlJHRnphR0p2WVhKa0xrZHlZV1pwWTI5eklqb2lRV05sYzNOdklpd2ljR1Z5YldsemMyRnZmREl6T0RBNlJHRnphR0p2WVhKa0xrZHlZV1pwWTI5ekxrUnBkbVZ5YzI5eklqb2lRV05sYzNOdklpd2ljR1Z5YldsemMyRnZmREl6T0RBNlJHRnphR0p2WVhKa0xrZHlZV1pwWTI5ekxsTnZZbkpsSWpvaVFXTmxjM052SWl3aWNHVnliV2x6YzJGdmZESXpPREE2UkdGemFHSnZZWEprTGxKbGJHRjBiM0pwYnk1U1pXeGhkRzl5YVc5RGNtbGhZMkZ2SWpvaVFXTmxjM052SWl3aWNHVnliV2x6YzJGdmZESXpPREE2UkdGemFHSnZZWEprTGxKbGJHRjBiM0pwYjNNdVVtVnNZWFJ2Y21sdlFXTmxjM052Y3lJNld5SkJZMlZ6YzI4aUxDSkJiSFJsY21GeUlpd2lSWGhqYkhWcGNpSXNJazV2ZG04aVhTd2ljR1Z5YldsemMyRnZmREl6T0RBNlNHOXRaU0k2SWtGalpYTnpieUlzSW5CbGNtMXBjM05oYjN3eU16Z3dPazV2ZEdsamFXRnpJam9pUVdObGMzTnZJaXdpY0dWeWJXbHpjMkZ2ZkRJek9EQTZVbVZzWVhSdmNtbHZjeUk2SWtGalpYTnpieUlzSW1GdGNpSTZXeUp3WVhOemQyOXlaQ0pkZlEuRWctYmRQQUhLTUlEbFZNaUdOSnhFSjl6cXRoMlVtVS1rMEVrMUJJdGhDNldLbmZ5Rk9RN0VRWEliUUdCckxobTRDSHJfc2l3cmdUaEFMNU5xM0dKQW8wX3d4ZmpnZGd0OTY1RkhaTE8wWGEtUVJUdmZXZHdDVTdfakhZamx3dXlKOElEaUVwUWY2eTZlZVVJTXhSSTBKWmEtYUlydDVNdE1Dck1NZWNUZFVSWEY5MWJYQkZkTkRKU0dMcHFyZjY4N0h1elVDSHJyem5CcjZ3Ty01LTVZMjRybnBUYkVjbFM5S0RKWXVUWm9CUUE2LVRrY3lfWEJIZzRjMXdod3dPUmY5TmZ2MWM4X1Y2WmpNTDFlaXFkbEs3TURqcW1zWmJBWmtTY3JKelpteHBvQk1rdkFNREloa21COFpWc0drcllJQ3F0ckFSNkJJdVRrMmFLM3o4bG93XCI7XHJcbiAgICBcclxuICAgICAgICAvL2NvbnN0IGFjY2Vzc1Rva2VuSlNPTjphbnkgPSBKU09OLnBhcnNlKGB7XCJpc3NcIjpcImh0dHBzOi8vcGptdHN0cy9cIixcImF1ZFwiOlwiaHR0cHM6Ly9wam10c3RzL3Jlc291cmNlc1wiLFwiZXhwXCI6MTQ2MjQwMzU4MixcIm5iZlwiOjE0NjIzOTk5ODIsXCJjbGllbnRfaWRcIjpcIjIzODBcIixcInNjb3BlXCI6W1wib3BlbmlkXCIsXCJwcm9maWxlXCIsXCJwam10X3Byb2ZpbGVcIixcImVtYWlsXCIsXCJwZXJtaXNzYW9fMjM4MFwiXSxcInN1YlwiOlwiMTY4NDNcIixcImF1dGhfdGltZVwiOjE0NjIzOTcwNDIsXCJpZHBcIjpcImlkc3J2XCIsXCJwZXJtaXNzYW98MjM4MDpEYXNoYm9hcmRcIjpcIkFjZXNzb1wiLFwicGVybWlzc2FvfDIzODA6RGFzaGJvYXJkLkdyYWZpY29zXCI6XCJBY2Vzc29cIixcInBlcm1pc3Nhb3wyMzgwOkRhc2hib2FyZC5HcmFmaWNvcy5EaXZlcnNvc1wiOlwiQWNlc3NvXCIsXCJwZXJtaXNzYW98MjM4MDpEYXNoYm9hcmQuR3JhZmljb3MuU29icmVcIjpcIkFjZXNzb1wiLFwicGVybWlzc2FvfDIzODA6RGFzaGJvYXJkLlJlbGF0b3Jpby5SZWxhdG9yaW9DcmlhY2FvXCI6XCJBY2Vzc29cIixcInBlcm1pc3Nhb3wyMzgwOkRhc2hib2FyZC5SZWxhdG9yaW9zLlJlbGF0b3Jpb0FjZXNzb3NcIjpbXCJBY2Vzc29cIixcIkFsdGVyYXJcIixcIkV4Y2x1aXJcIixcIk5vdm9cIl0sXCJwZXJtaXNzYW98MjM4MDpIb21lXCI6XCJBY2Vzc29cIixcInBlcm1pc3Nhb3wyMzgwOk5vdGljaWFzXCI6XCJBY2Vzc29cIixcInBlcm1pc3Nhb3wyMzgwOlJlbGF0b3Jpb3NcIjpcIkFjZXNzb1wiLFwiYW1yXCI6W1wicGFzc3dvcmRcIl19YCk7XHJcblxyXG4gICAgXHJcbiAgICBjb25zdCBpZGVudGl0eVRva2VuOnN0cmluZyA9IFwiZXlKMGVYQWlPaUpLVjFRaUxDSmhiR2NpT2lKU1V6STFOaUlzSW10cFpDSTZJbUV6Y2sxVlowMUdkamwwVUdOc1RHRTJlVVl6ZWtGclpuRjFSU0lzSW5nMWRDSTZJbUV6Y2sxVlowMUdkamwwVUdOc1RHRTJlVVl6ZWtGclpuRjFSU0o5LmV5SnBjM01pT2lKb2RIUndjem92TDNCcWJYUnpkSE12SWl3aVlYVmtJam9pTWpNNE1DSXNJbVY0Y0NJNk1UUTJNVGc0TWprek5Td2libUptSWpveE5EWXhPRGd5TmpNMUxDSnViMjVqWlNJNklqRXlNak13TWpBMk5UVTVORGt5TURnaUxDSnBZWFFpT2pFME5qRTRPREkyTXpVc0ltRjBYMmhoYzJnaU9pSXplVjlpU2kxb1pFWmlNakUzVkhOcFFVVnBWblozSWl3aVkxOW9ZWE5vSWpvaWJHaE1SREZPYVROa2NtczBhRUpLWVhCUVJVcGFRU0lzSW5OcFpDSTZJak5rTUdRek5XWXhOR0ZqWVdRM016RXlNMkUyWTJGbU1HVTVOVFk1TkdJeklpd2ljM1ZpSWpvaU1UWTRORE1pTENKaGRYUm9YM1JwYldVaU9qRTBOakV4TmpRNU16SXNJbWxrY0NJNkltbGtjM0oySWl3aVlXMXlJanBiSW5CaGMzTjNiM0prSWwxOS5oUzl2RkdjVXE2ajNDQlJzVURtMlJHMHp3eU5iZFJpak4xTF9mN0VtWDRkNW84V3hoOVJhV3hQbVlVU0FHdDIxMWxybnAxVzB6bTdIZldxT3Uzc3pKbmhDV0tmWF9QOUNZdWMtM055V1h4TDlpTVpNMDdsendldW5KZVlyV005OUtDV1Q5aWxfcHRSM2N2TkJFWlBCQkhCbXpRNUVQYkhxTWdhMzVVM1UwckhUdUMxMTM0cXZERkUtMllvR3lOWHhQNUtELXB5Vmx4MGhQWE9zZnY5eFlmS3I5QzMxZUVNcXl5YXZaV3BtaUg4WXd6MXZsSlRNZFg2WTlHbTc1OTlPanFlNjZtUkFhRFg3X3JmOGtlY2d2a1NaRDB1b3pIUEdJWC1ZOE9SUFM4M0FIWFRPRk9BWG9PM2h2eG5KSjZpTjFvVkpTeldWc0k1OVZGYnZNSWF3Q3dcIjtcclxuICAgIFxyXG4gICAgXHJcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICAgIFNlY3VyaXR5Q29udGV4dC5SZXNldCgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ0luaXQgc2hvdWxkIGluc3RhbnRpYXRlIGEgVXNlcicsICgpID0+IHtcclxuICAgIFxyXG4gICAgICAgIGxldCBzZWN1cml0eUNvbnRleHRJbml0aWFsaXplciA9IG5ldyBTZWN1cml0eUNvbnRleHRFbmNvZGVkVG9rZW5Jbml0aWFsaXplcihbYWNjZXNzVG9rZW4sIGlkZW50aXR5VG9rZW5dKTtcclxuICAgICAgICBTZWN1cml0eUNvbnRleHQuQ3VycmVudC5Jbml0KHNlY3VyaXR5Q29udGV4dEluaXRpYWxpemVyKTtcclxuICAgIFxyXG4gICAgICAgIC8vU2VjdXJpdHlDb250ZXh0LkN1cnJlbnQuVXNlci5wZXJtaXNzb2VzLmZpbHRlcigocGVybWlzc2FvKSA9PiBwZXJtaXNzYW8ucGVybWlzc29lcy5zb21lKChwZXJtKSA9PiBwZXJtID09IFwiXCIpKTtcclxuICAgIFxyXG4gICAgICAgIGV4cGVjdChTZWN1cml0eUNvbnRleHQuQ3VycmVudC5QcmluY2lwYWwpLnRvQmVEZWZpbmVkKCk7XHJcbiAgICBcclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICBpdCgnSW5pdCBzaG91bGQgaGF2ZSBhIFVzZXIgYXV0aGVudGljYXRlZCcsICgpID0+IHtcclxuICAgICAgICBcclxuICAgICAgICBsZXQgc2VjdXJpdHlDb250ZXh0SW5pdGlhbGl6ZXIgPSBuZXcgU2VjdXJpdHlDb250ZXh0RW5jb2RlZFRva2VuSW5pdGlhbGl6ZXIoW2FjY2Vzc1Rva2VuLCBpZGVudGl0eVRva2VuXSk7XHJcbiAgICAgICAgU2VjdXJpdHlDb250ZXh0LkN1cnJlbnQuSW5pdChzZWN1cml0eUNvbnRleHRJbml0aWFsaXplcik7XHJcbiAgICAgICAgXHJcbiAgICAgICAgZXhwZWN0KFNlY3VyaXR5Q29udGV4dC5DdXJyZW50LlByaW5jaXBhbC5Jc0F1dGhlbnRpY2F0ZWQpLnRvQmVUcnV0aHkoKTtcclxuICAgIFxyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIFxyXG4gICAgaXQoJ1VzZXIgc2hvdWxkIGhhdmUgY2xpZW50X2lkJywgKCkgPT4ge1xyXG4gICAgXHJcbiAgICAgICAgbGV0IHNlY3VyaXR5Q29udGV4dEluaXRpYWxpemVyID0gbmV3IFNlY3VyaXR5Q29udGV4dEVuY29kZWRUb2tlbkluaXRpYWxpemVyKFthY2Nlc3NUb2tlbiwgaWRlbnRpdHlUb2tlbl0pO1xyXG4gICAgICAgIFNlY3VyaXR5Q29udGV4dC5DdXJyZW50LkluaXQoc2VjdXJpdHlDb250ZXh0SW5pdGlhbGl6ZXIpO1xyXG4gICAgXHJcbiAgICAgICAgbGV0IGNsaWVudF9pZCA9ICg8SWRlbnRpdHk+U2VjdXJpdHlDb250ZXh0LkN1cnJlbnQuUHJpbmNpcGFsLklkZW50aXR5KS5maW5kRmlyc3Q8c3RyaW5nPignY2xpZW50X2lkJyk7XHJcbiAgICBcclxuICAgICAgICBleHBlY3QoY2xpZW50X2lkKS50b0JlKCcyMzgwJyk7XHJcbiAgICAgICAgXHJcbiAgICB9KTtcclxuICAgIFxyXG4gICAgaXQoJ1VzZXIgc2hvdWxkIG5vdCBiZSBhdXRoZW50aWNhdGVkJywgKCkgPT4ge1xyXG4gICAgICAgIFxyXG4gICAgICAgIGV4cGVjdChTZWN1cml0eUNvbnRleHQuQ3VycmVudC5QcmluY2lwYWwuSXNBdXRoZW50aWNhdGVkKS50b0JlKGZhbHNlKTtcclxuICAgIFxyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIFxyXG4gICAgaXQoJ1Nob3VsZCBsZXQgYSBDdXN0b21pemVkIElkZW50aXR5IGJlIHNldCcsICgpID0+IHtcclxuICAgICAgICBcclxuICAgICAgICBjbGFzcyBJZGVudGl0eUN1c3RvbWl6ZWQgZXh0ZW5kcyBJZGVudGl0eVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcHVibGljIGdldCBDbGllbnRJZCgpIDogc3RyaW5nIFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBsZXQgdmFsdWUgPSB0aGlzLmZpbmRGaXJzdDxzdHJpbmc+KCdjbGllbnRfaWQnKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICAvLyBsZXQgY3VzdG9taXplZElkZW50aXR5IDpJZGVudGl0eUN1c3RvbWl6ZWQgPSBJZGVudGl0eUZhY3RvcnkuQ3JlYXRlKElkZW50aXR5Q3VzdG9taXplZCwgW2FjY2Vzc1Rva2VuSlNPTl0pO1xyXG4gICAgICAgIC8vIFNlY3VyaXR5Q29udGV4dC5DdXJyZW50LlByaW5jaXBhbC5JZGVudGl0eSA9IGN1c3RvbWl6ZWRJZGVudGl0eTtcclxuICAgICAgICBcclxuICAgICAgICBsZXQgY3VzdG9taXplZElkZW50aXR5IDpJZGVudGl0eUN1c3RvbWl6ZWQgPSBuZXcgSWRlbnRpdHlDdXN0b21pemVkKFt7IGtleTogJ2NsaWVudF9pZCcsIHZhbHVlOiAnMjM4MCcgfV0pO1xyXG4gICAgICAgIFNlY3VyaXR5Q29udGV4dC5DdXJyZW50LlByaW5jaXBhbC5JZGVudGl0eSA9IGN1c3RvbWl6ZWRJZGVudGl0eTtcclxuICAgICAgICBcclxuICAgICAgICBjb25zb2xlLmxvZyhjdXN0b21pemVkSWRlbnRpdHkpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGV4cGVjdChjdXN0b21pemVkSWRlbnRpdHkuQ2xpZW50SWQpLnRvQmVUcnV0aHkoJzIzODAnKTtcclxuICAgIFxyXG4gICAgfSk7XHJcbn0pO1xyXG4iXX0=
