"use strict";
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
/// <reference path='../../typings/main.d.ts' />
var SecurityContext_1 = require('../src/SecurityContext');
var Identity_1 = require('../src/Identities/Identity');
//import {IdentityFactory} from '../src/Identities/IdentityFactory';
var SecurityContextEncodedTokenInitializer_1 = require('../src/SecurityContextEncodedTokenInitializer');
describe('SecurityContext', function () {
    var accessToken = "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6ImEzck1VZ01Gdjl0UGNsTGE2eUYzekFrZnF1RSIsIng1dCI6ImEzck1VZ01Gdjl0UGNsTGE2eUYzekFrZnF1RSJ9.eyJpc3MiOiJodHRwczovL3BqbXRzdHMvIiwiYXVkIjoiaHR0cHM6Ly9wam10c3RzL3Jlc291cmNlcyIsImV4cCI6MTQ2MTg4NjIzNSwibmJmIjoxNDYxODgyNjM1LCJjbGllbnRfaWQiOiIyMzgwIiwic2NvcGUiOlsib3BlbmlkIiwicHJvZmlsZSIsImVtYWlsIiwicGptdF9wcm9maWxlIiwicGVybWlzc2FvXzIzODAiXSwic3ViIjoiMTY4NDMiLCJhdXRoX3RpbWUiOjE0NjExNjQ5MzIsImlkcCI6Imlkc3J2IiwicGVybWlzc2FvfDIzODA6RGFzaGJvYXJkIjoiQWNlc3NvIiwicGVybWlzc2FvfDIzODA6RGFzaGJvYXJkLkdyYWZpY29zIjoiQWNlc3NvIiwicGVybWlzc2FvfDIzODA6RGFzaGJvYXJkLkdyYWZpY29zLkRpdmVyc29zIjoiQWNlc3NvIiwicGVybWlzc2FvfDIzODA6RGFzaGJvYXJkLkdyYWZpY29zLlNvYnJlIjoiQWNlc3NvIiwicGVybWlzc2FvfDIzODA6RGFzaGJvYXJkLlJlbGF0b3Jpby5SZWxhdG9yaW9DcmlhY2FvIjoiQWNlc3NvIiwicGVybWlzc2FvfDIzODA6RGFzaGJvYXJkLlJlbGF0b3Jpb3MuUmVsYXRvcmlvQWNlc3NvcyI6WyJBY2Vzc28iLCJBbHRlcmFyIiwiRXhjbHVpciIsIk5vdm8iXSwicGVybWlzc2FvfDIzODA6SG9tZSI6IkFjZXNzbyIsInBlcm1pc3Nhb3wyMzgwOk5vdGljaWFzIjoiQWNlc3NvIiwicGVybWlzc2FvfDIzODA6UmVsYXRvcmlvcyI6IkFjZXNzbyIsImFtciI6WyJwYXNzd29yZCJdfQ.Eg-bdPAHKMIDlVMiGNJxEJ9zqth2UmU-k0Ek1BIthC6WKnfyFOQ7EQXIbQGBrLhm4CHr_siwrgThAL5Nq3GJAo0_wxfjgdgt965FHZLO0Xa-QRTvfWdwCU7_jHYjlwuyJ8IDiEpQf6y6eeUIMxRI0JZa-aIrt5MtMCrMMecTdURXF91bXBFdNDJSGLpqrf687HuzUCHrrznBr6wO-5-5Y24rnpTbEclS9KDJYuTZoBQA6-Tkcy_XBHg4c1whwwORf9Nfv1c8_V6ZjML1eiqdlK7MDjqmsZbAZkScrJzZmxpoBMkvAMDIhkmB8ZVsGkrYICqtrAR6BIuTk2aK3z8low";
    //const accessTokenJSON:any = JSON.parse(`{"iss":"https://pjmtsts/","aud":"https://pjmtsts/resources","exp":1462403582,"nbf":1462399982,"client_id":"2380","scope":["openid","profile","pjmt_profile","email","permissao_2380"],"sub":"16843","auth_time":1462397042,"idp":"idsrv","permissao|2380:Dashboard":"Acesso","permissao|2380:Dashboard.Graficos":"Acesso","permissao|2380:Dashboard.Graficos.Diversos":"Acesso","permissao|2380:Dashboard.Graficos.Sobre":"Acesso","permissao|2380:Dashboard.Relatorio.RelatorioCriacao":"Acesso","permissao|2380:Dashboard.Relatorios.RelatorioAcessos":["Acesso","Alterar","Excluir","Novo"],"permissao|2380:Home":"Acesso","permissao|2380:Noticias":"Acesso","permissao|2380:Relatorios":"Acesso","amr":["password"]}`);
    var identityToken = "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6ImEzck1VZ01Gdjl0UGNsTGE2eUYzekFrZnF1RSIsIng1dCI6ImEzck1VZ01Gdjl0UGNsTGE2eUYzekFrZnF1RSJ9.eyJpc3MiOiJodHRwczovL3BqbXRzdHMvIiwiYXVkIjoiMjM4MCIsImV4cCI6MTQ2MTg4MjkzNSwibmJmIjoxNDYxODgyNjM1LCJub25jZSI6IjEyMjMwMjA2NTU5NDkyMDgiLCJpYXQiOjE0NjE4ODI2MzUsImF0X2hhc2giOiIzeV9iSi1oZEZiMjE3VHNpQUVpVnZ3IiwiY19oYXNoIjoibGhMRDFOaTNkcms0aEJKYXBQRUpaQSIsInNpZCI6IjNkMGQzNWYxNGFjYWQ3MzEyM2E2Y2FmMGU5NTY5NGIzIiwic3ViIjoiMTY4NDMiLCJhdXRoX3RpbWUiOjE0NjExNjQ5MzIsImlkcCI6Imlkc3J2IiwiYW1yIjpbInBhc3N3b3JkIl19.hS9vFGcUq6j3CBRsUDm2RG0zwyNbdRijN1L_f7EmX4d5o8Wxh9RaWxPmYUSAGt211lrnp1W0zm7HfWqOu3szJnhCWKfX_P9CYuc-3NyWXxL9iMZM07lzweunJeYrWM99KCWT9il_ptR3cvNBEZPBBHBmzQ5EPbHqMga35U3U0rHTuC1134qvDFE-2YoGyNXxP5KD-pyVlx0hPXOsfv9xYfKr9C31eEMqyyavZWpmiH8Ywz1vlJTMdX6Y9Gm7599Ojqe66mRAaDX7_rf8kecgvkSZD0uozHPGIX-Y8ORPS83AHXTOFOAXoO3hvxnJJ6iN1oVJSzWVsI59VFbvMIawCw";
    beforeEach(function () {
        SecurityContext_1.SecurityContext.Reset();
    });
    it('Init should instantiate a User', function () {
        var securityContextInitializer = new SecurityContextEncodedTokenInitializer_1.SecurityContextEncodedTokenInitializer([accessToken, identityToken]);
        SecurityContext_1.SecurityContext.Current.Init(securityContextInitializer);
        //SecurityContext.Current.User.permissoes.filter((permissao) => permissao.permissoes.some((perm) => perm == ""));
        expect(SecurityContext_1.SecurityContext.Current.Principal).toBeDefined();
    });
    it('Init should have a User authenticated', function () {
        var securityContextInitializer = new SecurityContextEncodedTokenInitializer_1.SecurityContextEncodedTokenInitializer([accessToken, identityToken]);
        SecurityContext_1.SecurityContext.Current.Init(securityContextInitializer);
        expect(SecurityContext_1.SecurityContext.Current.Principal.IsAuthenticated).toBeTruthy();
    });
    it('User should have client_id', function () {
        var securityContextInitializer = new SecurityContextEncodedTokenInitializer_1.SecurityContextEncodedTokenInitializer([accessToken, identityToken]);
        SecurityContext_1.SecurityContext.Current.Init(securityContextInitializer);
        var client_id = SecurityContext_1.SecurityContext.Current.Principal.Identity.findFirst('client_id');
        expect(client_id).toBe('2380');
    });
    it('User should not be authenticated', function () {
        expect(SecurityContext_1.SecurityContext.Current.Principal.IsAuthenticated).toBe(false);
    });
    it('Should let a Customized Identity be set', function () {
        var IdentityCustomized = (function (_super) {
            __extends(IdentityCustomized, _super);
            function IdentityCustomized() {
                _super.apply(this, arguments);
            }
            Object.defineProperty(IdentityCustomized.prototype, "ClientId", {
                get: function () {
                    var value = this.findFirst('client_id');
                    return value;
                },
                enumerable: true,
                configurable: true
            });
            return IdentityCustomized;
        }(Identity_1.Identity));
        // let customizedIdentity :IdentityCustomized = IdentityFactory.Create(IdentityCustomized, [accessTokenJSON]);
        // SecurityContext.Current.Principal.Identity = customizedIdentity;
        var customizedIdentity = new IdentityCustomized([{ key: 'client_id', value: '2380' }]);
        SecurityContext_1.SecurityContext.Current.Principal.Identity = customizedIdentity;
        console.log(customizedIdentity);
        expect(customizedIdentity.ClientId).toBeTruthy('2380');
    });
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNwZWMvU2VjdXJpdHlDb250ZXh0LnNwZWMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsZ0RBQWdEO0FBQ2hELGdDQUE4Qix3QkFBd0IsQ0FBQyxDQUFBO0FBQ3ZELHlCQUF1Qiw0QkFBNEIsQ0FBQyxDQUFBO0FBQ3BELG9FQUFvRTtBQUNwRSx1REFBcUQsK0NBQStDLENBQUMsQ0FBQTtBQUVyRyxRQUFRLENBQUMsaUJBQWlCLEVBQUU7SUFFeEIsSUFBTSxXQUFXLEdBQVUsZzRDQUFnNEMsQ0FBQztJQUV4NUMsc3VCQUFzdUI7SUFHMXVCLElBQU0sYUFBYSxHQUFVLDAyQkFBMDJCLENBQUM7SUFHMTRCLFVBQVUsQ0FBQztRQUNQLGlDQUFlLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDMUIsQ0FBQyxDQUFDLENBQUM7SUFFSCxFQUFFLENBQUMsZ0NBQWdDLEVBQUU7UUFFakMsSUFBSSwwQkFBMEIsR0FBRyxJQUFJLCtFQUFzQyxDQUFDLENBQUMsV0FBVyxFQUFFLGFBQWEsQ0FBQyxDQUFDLENBQUM7UUFDMUcsaUNBQWUsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLDBCQUEwQixDQUFDLENBQUM7UUFFekQsaUhBQWlIO1FBRWpILE1BQU0sQ0FBQyxpQ0FBZSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztJQUU1RCxDQUFDLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQyx1Q0FBdUMsRUFBRTtRQUV4QyxJQUFJLDBCQUEwQixHQUFHLElBQUksK0VBQXNDLENBQUMsQ0FBQyxXQUFXLEVBQUUsYUFBYSxDQUFDLENBQUMsQ0FBQztRQUMxRyxpQ0FBZSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsMEJBQTBCLENBQUMsQ0FBQztRQUV6RCxNQUFNLENBQUMsaUNBQWUsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLGVBQWUsQ0FBQyxDQUFDLFVBQVUsRUFBRSxDQUFDO0lBRTNFLENBQUMsQ0FBQyxDQUFDO0lBR0gsRUFBRSxDQUFDLDRCQUE0QixFQUFFO1FBRTdCLElBQUksMEJBQTBCLEdBQUcsSUFBSSwrRUFBc0MsQ0FBQyxDQUFDLFdBQVcsRUFBRSxhQUFhLENBQUMsQ0FBQyxDQUFDO1FBQzFHLGlDQUFlLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO1FBRXpELElBQUksU0FBUyxHQUFjLGlDQUFlLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxRQUFTLENBQUMsU0FBUyxDQUFTLFdBQVcsQ0FBQyxDQUFDO1FBRXRHLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7SUFFbkMsQ0FBQyxDQUFDLENBQUM7SUFFSCxFQUFFLENBQUMsa0NBQWtDLEVBQUU7UUFFbkMsTUFBTSxDQUFDLGlDQUFlLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7SUFFMUUsQ0FBQyxDQUFDLENBQUM7SUFHSCxFQUFFLENBQUMseUNBQXlDLEVBQUU7UUFFMUM7WUFBaUMsc0NBQVE7WUFBekM7Z0JBQWlDLDhCQUFRO1lBT3pDLENBQUM7WUFMRyxzQkFBVyx3Q0FBUTtxQkFBbkI7b0JBRUksSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBUyxXQUFXLENBQUMsQ0FBQztvQkFDaEQsTUFBTSxDQUFDLEtBQUssQ0FBQztnQkFDakIsQ0FBQzs7O2VBQUE7WUFDTCx5QkFBQztRQUFELENBUEEsQUFPQyxDQVBnQyxtQkFBUSxHQU94QztRQUVELDhHQUE4RztRQUM5RyxtRUFBbUU7UUFFbkUsSUFBSSxrQkFBa0IsR0FBdUIsSUFBSSxrQkFBa0IsQ0FBQyxDQUFDLEVBQUUsR0FBRyxFQUFFLFdBQVcsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQzNHLGlDQUFlLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxRQUFRLEdBQUcsa0JBQWtCLENBQUM7UUFFaEUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO1FBRWhDLE1BQU0sQ0FBQyxrQkFBa0IsQ0FBQyxRQUFRLENBQUMsQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUM7SUFFM0QsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDLENBQUMsQ0FBQyIsImZpbGUiOiJzcGVjL1NlY3VyaXR5Q29udGV4dC5zcGVjLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8vIDxyZWZlcmVuY2UgcGF0aD0nLi4vLi4vdHlwaW5ncy9tYWluLmQudHMnIC8+XHJcbmltcG9ydCB7U2VjdXJpdHlDb250ZXh0fSBmcm9tICcuLi9zcmMvU2VjdXJpdHlDb250ZXh0JztcclxuaW1wb3J0IHtJZGVudGl0eX0gZnJvbSAnLi4vc3JjL0lkZW50aXRpZXMvSWRlbnRpdHknO1xyXG4vL2ltcG9ydCB7SWRlbnRpdHlGYWN0b3J5fSBmcm9tICcuLi9zcmMvSWRlbnRpdGllcy9JZGVudGl0eUZhY3RvcnknO1xyXG5pbXBvcnQge1NlY3VyaXR5Q29udGV4dEVuY29kZWRUb2tlbkluaXRpYWxpemVyfSBmcm9tICcuLi9zcmMvU2VjdXJpdHlDb250ZXh0RW5jb2RlZFRva2VuSW5pdGlhbGl6ZXInO1xyXG5cclxuZGVzY3JpYmUoJ1NlY3VyaXR5Q29udGV4dCcsICgpID0+IHtcclxuICAgIFxyXG4gICAgY29uc3QgYWNjZXNzVG9rZW46c3RyaW5nID0gXCJleUowZVhBaU9pSktWMVFpTENKaGJHY2lPaUpTVXpJMU5pSXNJbXRwWkNJNkltRXpjazFWWjAxR2RqbDBVR05zVEdFMmVVWXpla0ZyWm5GMVJTSXNJbmcxZENJNkltRXpjazFWWjAxR2RqbDBVR05zVEdFMmVVWXpla0ZyWm5GMVJTSjkuZXlKcGMzTWlPaUpvZEhSd2N6b3ZMM0JxYlhSemRITXZJaXdpWVhWa0lqb2lhSFIwY0hNNkx5OXdhbTEwYzNSekwzSmxjMjkxY21ObGN5SXNJbVY0Y0NJNk1UUTJNVGc0TmpJek5Td2libUptSWpveE5EWXhPRGd5TmpNMUxDSmpiR2xsYm5SZmFXUWlPaUl5TXpnd0lpd2ljMk52Y0dVaU9sc2liM0JsYm1sa0lpd2ljSEp2Wm1sc1pTSXNJbVZ0WVdsc0lpd2ljR3B0ZEY5d2NtOW1hV3hsSWl3aWNHVnliV2x6YzJGdlh6SXpPREFpWFN3aWMzVmlJam9pTVRZNE5ETWlMQ0poZFhSb1gzUnBiV1VpT2pFME5qRXhOalE1TXpJc0ltbGtjQ0k2SW1sa2MzSjJJaXdpY0dWeWJXbHpjMkZ2ZkRJek9EQTZSR0Z6YUdKdllYSmtJam9pUVdObGMzTnZJaXdpY0dWeWJXbHpjMkZ2ZkRJek9EQTZSR0Z6YUdKdllYSmtMa2R5WVdacFkyOXpJam9pUVdObGMzTnZJaXdpY0dWeWJXbHpjMkZ2ZkRJek9EQTZSR0Z6YUdKdllYSmtMa2R5WVdacFkyOXpMa1JwZG1WeWMyOXpJam9pUVdObGMzTnZJaXdpY0dWeWJXbHpjMkZ2ZkRJek9EQTZSR0Z6YUdKdllYSmtMa2R5WVdacFkyOXpMbE52WW5KbElqb2lRV05sYzNOdklpd2ljR1Z5YldsemMyRnZmREl6T0RBNlJHRnphR0p2WVhKa0xsSmxiR0YwYjNKcGJ5NVNaV3hoZEc5eWFXOURjbWxoWTJGdklqb2lRV05sYzNOdklpd2ljR1Z5YldsemMyRnZmREl6T0RBNlJHRnphR0p2WVhKa0xsSmxiR0YwYjNKcGIzTXVVbVZzWVhSdmNtbHZRV05sYzNOdmN5STZXeUpCWTJWemMyOGlMQ0pCYkhSbGNtRnlJaXdpUlhoamJIVnBjaUlzSWs1dmRtOGlYU3dpY0dWeWJXbHpjMkZ2ZkRJek9EQTZTRzl0WlNJNklrRmpaWE56YnlJc0luQmxjbTFwYzNOaGIzd3lNemd3T2s1dmRHbGphV0Z6SWpvaVFXTmxjM052SWl3aWNHVnliV2x6YzJGdmZESXpPREE2VW1Wc1lYUnZjbWx2Y3lJNklrRmpaWE56YnlJc0ltRnRjaUk2V3lKd1lYTnpkMjl5WkNKZGZRLkVnLWJkUEFIS01JRGxWTWlHTkp4RUo5enF0aDJVbVUtazBFazFCSXRoQzZXS25meUZPUTdFUVhJYlFHQnJMaG00Q0hyX3Npd3JnVGhBTDVOcTNHSkFvMF93eGZqZ2RndDk2NUZIWkxPMFhhLVFSVHZmV2R3Q1U3X2pIWWpsd3V5SjhJRGlFcFFmNnk2ZWVVSU14UkkwSlphLWFJcnQ1TXRNQ3JNTWVjVGRVUlhGOTFiWEJGZE5ESlNHTHBxcmY2ODdIdXpVQ0hycnpuQnI2d08tNS01WTI0cm5wVGJFY2xTOUtESll1VFpvQlFBNi1Ua2N5X1hCSGc0YzF3aHd3T1JmOU5mdjFjOF9WNlpqTUwxZWlxZGxLN01EanFtc1piQVprU2NySnpabXhwb0JNa3ZBTURJaGttQjhaVnNHa3JZSUNxdHJBUjZCSXVUazJhSzN6OGxvd1wiO1xyXG4gICAgXHJcbiAgICAgICAgLy9jb25zdCBhY2Nlc3NUb2tlbkpTT046YW55ID0gSlNPTi5wYXJzZShge1wiaXNzXCI6XCJodHRwczovL3BqbXRzdHMvXCIsXCJhdWRcIjpcImh0dHBzOi8vcGptdHN0cy9yZXNvdXJjZXNcIixcImV4cFwiOjE0NjI0MDM1ODIsXCJuYmZcIjoxNDYyMzk5OTgyLFwiY2xpZW50X2lkXCI6XCIyMzgwXCIsXCJzY29wZVwiOltcIm9wZW5pZFwiLFwicHJvZmlsZVwiLFwicGptdF9wcm9maWxlXCIsXCJlbWFpbFwiLFwicGVybWlzc2FvXzIzODBcIl0sXCJzdWJcIjpcIjE2ODQzXCIsXCJhdXRoX3RpbWVcIjoxNDYyMzk3MDQyLFwiaWRwXCI6XCJpZHNydlwiLFwicGVybWlzc2FvfDIzODA6RGFzaGJvYXJkXCI6XCJBY2Vzc29cIixcInBlcm1pc3Nhb3wyMzgwOkRhc2hib2FyZC5HcmFmaWNvc1wiOlwiQWNlc3NvXCIsXCJwZXJtaXNzYW98MjM4MDpEYXNoYm9hcmQuR3JhZmljb3MuRGl2ZXJzb3NcIjpcIkFjZXNzb1wiLFwicGVybWlzc2FvfDIzODA6RGFzaGJvYXJkLkdyYWZpY29zLlNvYnJlXCI6XCJBY2Vzc29cIixcInBlcm1pc3Nhb3wyMzgwOkRhc2hib2FyZC5SZWxhdG9yaW8uUmVsYXRvcmlvQ3JpYWNhb1wiOlwiQWNlc3NvXCIsXCJwZXJtaXNzYW98MjM4MDpEYXNoYm9hcmQuUmVsYXRvcmlvcy5SZWxhdG9yaW9BY2Vzc29zXCI6W1wiQWNlc3NvXCIsXCJBbHRlcmFyXCIsXCJFeGNsdWlyXCIsXCJOb3ZvXCJdLFwicGVybWlzc2FvfDIzODA6SG9tZVwiOlwiQWNlc3NvXCIsXCJwZXJtaXNzYW98MjM4MDpOb3RpY2lhc1wiOlwiQWNlc3NvXCIsXCJwZXJtaXNzYW98MjM4MDpSZWxhdG9yaW9zXCI6XCJBY2Vzc29cIixcImFtclwiOltcInBhc3N3b3JkXCJdfWApO1xyXG5cclxuICAgIFxyXG4gICAgY29uc3QgaWRlbnRpdHlUb2tlbjpzdHJpbmcgPSBcImV5SjBlWEFpT2lKS1YxUWlMQ0poYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1FemNrMVZaMDFHZGpsMFVHTnNUR0UyZVVZemVrRnJabkYxUlNJc0luZzFkQ0k2SW1FemNrMVZaMDFHZGpsMFVHTnNUR0UyZVVZemVrRnJabkYxUlNKOS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkwzQnFiWFJ6ZEhNdklpd2lZWFZrSWpvaU1qTTRNQ0lzSW1WNGNDSTZNVFEyTVRnNE1qa3pOU3dpYm1KbUlqb3hORFl4T0RneU5qTTFMQ0p1YjI1alpTSTZJakV5TWpNd01qQTJOVFU1TkRreU1EZ2lMQ0pwWVhRaU9qRTBOakU0T0RJMk16VXNJbUYwWDJoaGMyZ2lPaUl6ZVY5aVNpMW9aRVppTWpFM1ZITnBRVVZwVm5aM0lpd2lZMTlvWVhOb0lqb2liR2hNUkRGT2FUTmtjbXMwYUVKS1lYQlFSVXBhUVNJc0luTnBaQ0k2SWpOa01HUXpOV1l4TkdGallXUTNNekV5TTJFMlkyRm1NR1U1TlRZNU5HSXpJaXdpYzNWaUlqb2lNVFk0TkRNaUxDSmhkWFJvWDNScGJXVWlPakUwTmpFeE5qUTVNeklzSW1sa2NDSTZJbWxrYzNKMklpd2lZVzF5SWpwYkluQmhjM04zYjNKa0lsMTkuaFM5dkZHY1VxNmozQ0JSc1VEbTJSRzB6d3lOYmRSaWpOMUxfZjdFbVg0ZDVvOFd4aDlSYVd4UG1ZVVNBR3QyMTFscm5wMVcwem03SGZXcU91M3N6Sm5oQ1dLZlhfUDlDWXVjLTNOeVdYeEw5aU1aTTA3bHp3ZXVuSmVZcldNOTlLQ1dUOWlsX3B0UjNjdk5CRVpQQkJIQm16UTVFUGJIcU1nYTM1VTNVMHJIVHVDMTEzNHF2REZFLTJZb0d5Tlh4UDVLRC1weVZseDBoUFhPc2Z2OXhZZktyOUMzMWVFTXF5eWF2WldwbWlIOFl3ejF2bEpUTWRYNlk5R203NTk5T2pxZTY2bVJBYURYN19yZjhrZWNndmtTWkQwdW96SFBHSVgtWThPUlBTODNBSFhUT0ZPQVhvTzNodnhuSko2aU4xb1ZKU3pXVnNJNTlWRmJ2TUlhd0N3XCI7XHJcbiAgICBcclxuICAgIFxyXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgICBTZWN1cml0eUNvbnRleHQuUmVzZXQoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdJbml0IHNob3VsZCBpbnN0YW50aWF0ZSBhIFVzZXInLCAoKSA9PiB7XHJcbiAgICBcclxuICAgICAgICBsZXQgc2VjdXJpdHlDb250ZXh0SW5pdGlhbGl6ZXIgPSBuZXcgU2VjdXJpdHlDb250ZXh0RW5jb2RlZFRva2VuSW5pdGlhbGl6ZXIoW2FjY2Vzc1Rva2VuLCBpZGVudGl0eVRva2VuXSk7XHJcbiAgICAgICAgU2VjdXJpdHlDb250ZXh0LkN1cnJlbnQuSW5pdChzZWN1cml0eUNvbnRleHRJbml0aWFsaXplcik7XHJcbiAgICBcclxuICAgICAgICAvL1NlY3VyaXR5Q29udGV4dC5DdXJyZW50LlVzZXIucGVybWlzc29lcy5maWx0ZXIoKHBlcm1pc3NhbykgPT4gcGVybWlzc2FvLnBlcm1pc3NvZXMuc29tZSgocGVybSkgPT4gcGVybSA9PSBcIlwiKSk7XHJcbiAgICBcclxuICAgICAgICBleHBlY3QoU2VjdXJpdHlDb250ZXh0LkN1cnJlbnQuUHJpbmNpcGFsKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgXHJcbiAgICB9KTtcclxuICAgIFxyXG4gICAgaXQoJ0luaXQgc2hvdWxkIGhhdmUgYSBVc2VyIGF1dGhlbnRpY2F0ZWQnLCAoKSA9PiB7XHJcbiAgICAgICAgXHJcbiAgICAgICAgbGV0IHNlY3VyaXR5Q29udGV4dEluaXRpYWxpemVyID0gbmV3IFNlY3VyaXR5Q29udGV4dEVuY29kZWRUb2tlbkluaXRpYWxpemVyKFthY2Nlc3NUb2tlbiwgaWRlbnRpdHlUb2tlbl0pO1xyXG4gICAgICAgIFNlY3VyaXR5Q29udGV4dC5DdXJyZW50LkluaXQoc2VjdXJpdHlDb250ZXh0SW5pdGlhbGl6ZXIpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGV4cGVjdChTZWN1cml0eUNvbnRleHQuQ3VycmVudC5QcmluY2lwYWwuSXNBdXRoZW50aWNhdGVkKS50b0JlVHJ1dGh5KCk7XHJcbiAgICBcclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICBcclxuICAgIGl0KCdVc2VyIHNob3VsZCBoYXZlIGNsaWVudF9pZCcsICgpID0+IHtcclxuICAgIFxyXG4gICAgICAgIGxldCBzZWN1cml0eUNvbnRleHRJbml0aWFsaXplciA9IG5ldyBTZWN1cml0eUNvbnRleHRFbmNvZGVkVG9rZW5Jbml0aWFsaXplcihbYWNjZXNzVG9rZW4sIGlkZW50aXR5VG9rZW5dKTtcclxuICAgICAgICBTZWN1cml0eUNvbnRleHQuQ3VycmVudC5Jbml0KHNlY3VyaXR5Q29udGV4dEluaXRpYWxpemVyKTtcclxuICAgIFxyXG4gICAgICAgIGxldCBjbGllbnRfaWQgPSAoPElkZW50aXR5PlNlY3VyaXR5Q29udGV4dC5DdXJyZW50LlByaW5jaXBhbC5JZGVudGl0eSkuZmluZEZpcnN0PHN0cmluZz4oJ2NsaWVudF9pZCcpO1xyXG4gICAgXHJcbiAgICAgICAgZXhwZWN0KGNsaWVudF9pZCkudG9CZSgnMjM4MCcpO1xyXG4gICAgICAgIFxyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIGl0KCdVc2VyIHNob3VsZCBub3QgYmUgYXV0aGVudGljYXRlZCcsICgpID0+IHtcclxuICAgICAgICBcclxuICAgICAgICBleHBlY3QoU2VjdXJpdHlDb250ZXh0LkN1cnJlbnQuUHJpbmNpcGFsLklzQXV0aGVudGljYXRlZCkudG9CZShmYWxzZSk7XHJcbiAgICBcclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICBcclxuICAgIGl0KCdTaG91bGQgbGV0IGEgQ3VzdG9taXplZCBJZGVudGl0eSBiZSBzZXQnLCAoKSA9PiB7XHJcbiAgICAgICAgXHJcbiAgICAgICAgY2xhc3MgSWRlbnRpdHlDdXN0b21pemVkIGV4dGVuZHMgSWRlbnRpdHlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHB1YmxpYyBnZXQgQ2xpZW50SWQoKSA6IHN0cmluZyBcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgbGV0IHZhbHVlID0gdGhpcy5maW5kRmlyc3Q8c3RyaW5nPignY2xpZW50X2lkJyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gbGV0IGN1c3RvbWl6ZWRJZGVudGl0eSA6SWRlbnRpdHlDdXN0b21pemVkID0gSWRlbnRpdHlGYWN0b3J5LkNyZWF0ZShJZGVudGl0eUN1c3RvbWl6ZWQsIFthY2Nlc3NUb2tlbkpTT05dKTtcclxuICAgICAgICAvLyBTZWN1cml0eUNvbnRleHQuQ3VycmVudC5QcmluY2lwYWwuSWRlbnRpdHkgPSBjdXN0b21pemVkSWRlbnRpdHk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgbGV0IGN1c3RvbWl6ZWRJZGVudGl0eSA6SWRlbnRpdHlDdXN0b21pemVkID0gbmV3IElkZW50aXR5Q3VzdG9taXplZChbeyBrZXk6ICdjbGllbnRfaWQnLCB2YWx1ZTogJzIzODAnIH1dKTtcclxuICAgICAgICBTZWN1cml0eUNvbnRleHQuQ3VycmVudC5QcmluY2lwYWwuSWRlbnRpdHkgPSBjdXN0b21pemVkSWRlbnRpdHk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgY29uc29sZS5sb2coY3VzdG9taXplZElkZW50aXR5KTtcclxuICAgICAgICBcclxuICAgICAgICBleHBlY3QoY3VzdG9taXplZElkZW50aXR5LkNsaWVudElkKS50b0JlVHJ1dGh5KCcyMzgwJyk7XHJcbiAgICBcclxuICAgIH0pO1xyXG59KTtcclxuIl19
