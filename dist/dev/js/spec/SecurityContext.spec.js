System.register(['../src/SecurityContext', '../src/Identities/Identity', '../src/SecurityContextEncodedTokenInitializer'], function(exports_1, context_1) {
    "use strict";
    var __moduleName = context_1 && context_1.id;
    var __extends = (this && this.__extends) || function (d, b) {
        for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
    var SecurityContext_1, Identity_1, SecurityContextEncodedTokenInitializer_1;
    return {
        setters:[
            function (SecurityContext_1_1) {
                SecurityContext_1 = SecurityContext_1_1;
            },
            function (Identity_1_1) {
                Identity_1 = Identity_1_1;
            },
            function (SecurityContextEncodedTokenInitializer_1_1) {
                SecurityContextEncodedTokenInitializer_1 = SecurityContextEncodedTokenInitializer_1_1;
            }],
        execute: function() {
            describe('SecurityContext', function () {
                var accessToken = "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6ImEzck1VZ01Gdjl0UGNsTGE2eUYzekFrZnF1RSIsIng1dCI6ImEzck1VZ01Gdjl0UGNsTGE2eUYzekFrZnF1RSJ9.eyJpc3MiOiJodHRwczovL3BqbXRzdHMvIiwiYXVkIjoiaHR0cHM6Ly9wam10c3RzL3Jlc291cmNlcyIsImV4cCI6MTQ2MTg4NjIzNSwibmJmIjoxNDYxODgyNjM1LCJjbGllbnRfaWQiOiIyMzgwIiwic2NvcGUiOlsib3BlbmlkIiwicHJvZmlsZSIsImVtYWlsIiwicGptdF9wcm9maWxlIiwicGVybWlzc2FvXzIzODAiXSwic3ViIjoiMTY4NDMiLCJhdXRoX3RpbWUiOjE0NjExNjQ5MzIsImlkcCI6Imlkc3J2IiwicGVybWlzc2FvfDIzODA6RGFzaGJvYXJkIjoiQWNlc3NvIiwicGVybWlzc2FvfDIzODA6RGFzaGJvYXJkLkdyYWZpY29zIjoiQWNlc3NvIiwicGVybWlzc2FvfDIzODA6RGFzaGJvYXJkLkdyYWZpY29zLkRpdmVyc29zIjoiQWNlc3NvIiwicGVybWlzc2FvfDIzODA6RGFzaGJvYXJkLkdyYWZpY29zLlNvYnJlIjoiQWNlc3NvIiwicGVybWlzc2FvfDIzODA6RGFzaGJvYXJkLlJlbGF0b3Jpby5SZWxhdG9yaW9DcmlhY2FvIjoiQWNlc3NvIiwicGVybWlzc2FvfDIzODA6RGFzaGJvYXJkLlJlbGF0b3Jpb3MuUmVsYXRvcmlvQWNlc3NvcyI6WyJBY2Vzc28iLCJBbHRlcmFyIiwiRXhjbHVpciIsIk5vdm8iXSwicGVybWlzc2FvfDIzODA6SG9tZSI6IkFjZXNzbyIsInBlcm1pc3Nhb3wyMzgwOk5vdGljaWFzIjoiQWNlc3NvIiwicGVybWlzc2FvfDIzODA6UmVsYXRvcmlvcyI6IkFjZXNzbyIsImFtciI6WyJwYXNzd29yZCJdfQ.Eg-bdPAHKMIDlVMiGNJxEJ9zqth2UmU-k0Ek1BIthC6WKnfyFOQ7EQXIbQGBrLhm4CHr_siwrgThAL5Nq3GJAo0_wxfjgdgt965FHZLO0Xa-QRTvfWdwCU7_jHYjlwuyJ8IDiEpQf6y6eeUIMxRI0JZa-aIrt5MtMCrMMecTdURXF91bXBFdNDJSGLpqrf687HuzUCHrrznBr6wO-5-5Y24rnpTbEclS9KDJYuTZoBQA6-Tkcy_XBHg4c1whwwORf9Nfv1c8_V6ZjML1eiqdlK7MDjqmsZbAZkScrJzZmxpoBMkvAMDIhkmB8ZVsGkrYICqtrAR6BIuTk2aK3z8low";
                //const accessTokenJSON:any = JSON.parse(`{"iss":"https://pjmtsts/","aud":"https://pjmtsts/resources","exp":1462403582,"nbf":1462399982,"client_id":"2380","scope":["openid","profile","pjmt_profile","email","permissao_2380"],"sub":"16843","auth_time":1462397042,"idp":"idsrv","permissao|2380:Dashboard":"Acesso","permissao|2380:Dashboard.Graficos":"Acesso","permissao|2380:Dashboard.Graficos.Diversos":"Acesso","permissao|2380:Dashboard.Graficos.Sobre":"Acesso","permissao|2380:Dashboard.Relatorio.RelatorioCriacao":"Acesso","permissao|2380:Dashboard.Relatorios.RelatorioAcessos":["Acesso","Alterar","Excluir","Novo"],"permissao|2380:Home":"Acesso","permissao|2380:Noticias":"Acesso","permissao|2380:Relatorios":"Acesso","amr":["password"]}`);
                var identityToken = "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6ImEzck1VZ01Gdjl0UGNsTGE2eUYzekFrZnF1RSIsIng1dCI6ImEzck1VZ01Gdjl0UGNsTGE2eUYzekFrZnF1RSJ9.eyJpc3MiOiJodHRwczovL3BqbXRzdHMvIiwiYXVkIjoiMjM4MCIsImV4cCI6MTQ2MTg4MjkzNSwibmJmIjoxNDYxODgyNjM1LCJub25jZSI6IjEyMjMwMjA2NTU5NDkyMDgiLCJpYXQiOjE0NjE4ODI2MzUsImF0X2hhc2giOiIzeV9iSi1oZEZiMjE3VHNpQUVpVnZ3IiwiY19oYXNoIjoibGhMRDFOaTNkcms0aEJKYXBQRUpaQSIsInNpZCI6IjNkMGQzNWYxNGFjYWQ3MzEyM2E2Y2FmMGU5NTY5NGIzIiwic3ViIjoiMTY4NDMiLCJhdXRoX3RpbWUiOjE0NjExNjQ5MzIsImlkcCI6Imlkc3J2IiwiYW1yIjpbInBhc3N3b3JkIl19.hS9vFGcUq6j3CBRsUDm2RG0zwyNbdRijN1L_f7EmX4d5o8Wxh9RaWxPmYUSAGt211lrnp1W0zm7HfWqOu3szJnhCWKfX_P9CYuc-3NyWXxL9iMZM07lzweunJeYrWM99KCWT9il_ptR3cvNBEZPBBHBmzQ5EPbHqMga35U3U0rHTuC1134qvDFE-2YoGyNXxP5KD-pyVlx0hPXOsfv9xYfKr9C31eEMqyyavZWpmiH8Ywz1vlJTMdX6Y9Gm7599Ojqe66mRAaDX7_rf8kecgvkSZD0uozHPGIX-Y8ORPS83AHXTOFOAXoO3hvxnJJ6iN1oVJSzWVsI59VFbvMIawCw";
                beforeEach(function () {
                    SecurityContext_1.default.Reset();
                });
                it('Init should instantiate a User', function () {
                    var securityContextInitializer = new SecurityContextEncodedTokenInitializer_1.default([accessToken, identityToken]);
                    SecurityContext_1.default.Current.Init(securityContextInitializer);
                    //SecurityContext.Current.User.permissoes.filter((permissao) => permissao.permissoes.some((perm) => perm == ""));
                    expect(SecurityContext_1.default.Current.Principal).toBeDefined();
                });
                it('Init should have a User authenticated', function () {
                    var securityContextInitializer = new SecurityContextEncodedTokenInitializer_1.default([accessToken, identityToken]);
                    SecurityContext_1.default.Current.Init(securityContextInitializer);
                    expect(SecurityContext_1.default.Current.Principal.IsAuthenticated).toBeTruthy();
                });
                it('User should have client_id', function () {
                    var securityContextInitializer = new SecurityContextEncodedTokenInitializer_1.default([accessToken, identityToken]);
                    SecurityContext_1.default.Current.Init(securityContextInitializer);
                    var client_id = SecurityContext_1.default.Current.Principal.Identity.findFirst('client_id');
                    expect(client_id).toBe('2380');
                });
                it('User should not be authenticated', function () {
                    expect(SecurityContext_1.default.Current.Principal.IsAuthenticated).toBe(false);
                });
                it('Should let a Customized Identity be set', function () {
                    var IdentityCustomized = (function (_super) {
                        __extends(IdentityCustomized, _super);
                        function IdentityCustomized() {
                            _super.apply(this, arguments);
                        }
                        Object.defineProperty(IdentityCustomized.prototype, "ClientId", {
                            get: function () {
                                var value = this.findFirst('client_id');
                                return value;
                            },
                            enumerable: true,
                            configurable: true
                        });
                        return IdentityCustomized;
                    }(Identity_1.default));
                    // let customizedIdentity :IdentityCustomized = IdentityFactory.Create(IdentityCustomized, [accessTokenJSON]);
                    // SecurityContext.Current.Principal.Identity = customizedIdentity;
                    var customizedIdentity = new IdentityCustomized([{ key: 'client_id', value: '2380' }]);
                    SecurityContext_1.default.Current.Principal.Identity = customizedIdentity;
                    console.log(customizedIdentity);
                    expect(customizedIdentity.ClientId).toBeTruthy('2380');
                });
            });
        }
    }
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNwZWMvU2VjdXJpdHlDb250ZXh0LnNwZWMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O1lBTUEsUUFBUSxDQUFDLGlCQUFpQixFQUFFO2dCQUV4QixJQUFNLFdBQVcsR0FBVSxnNENBQWc0QyxDQUFDO2dCQUV4NUMsc3VCQUFzdUI7Z0JBRzF1QixJQUFNLGFBQWEsR0FBVSwwMkJBQTAyQixDQUFDO2dCQUcxNEIsVUFBVSxDQUFDO29CQUNQLHlCQUFlLENBQUMsS0FBSyxFQUFFLENBQUM7Z0JBQzFCLENBQUMsQ0FBQyxDQUFDO2dCQUVILEVBQUUsQ0FBQyxnQ0FBZ0MsRUFBRTtvQkFFakMsSUFBSSwwQkFBMEIsR0FBRyxJQUFJLGdEQUFzQyxDQUFDLENBQUMsV0FBVyxFQUFFLGFBQWEsQ0FBQyxDQUFDLENBQUM7b0JBQzFHLHlCQUFlLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO29CQUV6RCxpSEFBaUg7b0JBRWpILE1BQU0sQ0FBQyx5QkFBZSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztnQkFFNUQsQ0FBQyxDQUFDLENBQUM7Z0JBRUgsRUFBRSxDQUFDLHVDQUF1QyxFQUFFO29CQUV4QyxJQUFJLDBCQUEwQixHQUFHLElBQUksZ0RBQXNDLENBQUMsQ0FBQyxXQUFXLEVBQUUsYUFBYSxDQUFDLENBQUMsQ0FBQztvQkFDMUcseUJBQWUsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLDBCQUEwQixDQUFDLENBQUM7b0JBRXpELE1BQU0sQ0FBQyx5QkFBZSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsZUFBZSxDQUFDLENBQUMsVUFBVSxFQUFFLENBQUM7Z0JBRTNFLENBQUMsQ0FBQyxDQUFDO2dCQUdILEVBQUUsQ0FBQyw0QkFBNEIsRUFBRTtvQkFFN0IsSUFBSSwwQkFBMEIsR0FBRyxJQUFJLGdEQUFzQyxDQUFDLENBQUMsV0FBVyxFQUFFLGFBQWEsQ0FBQyxDQUFDLENBQUM7b0JBQzFHLHlCQUFlLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO29CQUV6RCxJQUFJLFNBQVMsR0FBYyx5QkFBZSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsUUFBUyxDQUFDLFNBQVMsQ0FBUyxXQUFXLENBQUMsQ0FBQztvQkFFdEcsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztnQkFFbkMsQ0FBQyxDQUFDLENBQUM7Z0JBRUgsRUFBRSxDQUFDLGtDQUFrQyxFQUFFO29CQUVuQyxNQUFNLENBQUMseUJBQWUsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLGVBQWUsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztnQkFFMUUsQ0FBQyxDQUFDLENBQUM7Z0JBR0gsRUFBRSxDQUFDLHlDQUF5QyxFQUFFO29CQUUxQzt3QkFBaUMsc0NBQVE7d0JBQXpDOzRCQUFpQyw4QkFBUTt3QkFPekMsQ0FBQzt3QkFMRyxzQkFBVyx3Q0FBUTtpQ0FBbkI7Z0NBRUksSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBUyxXQUFXLENBQUMsQ0FBQztnQ0FDaEQsTUFBTSxDQUFDLEtBQUssQ0FBQzs0QkFDakIsQ0FBQzs7OzJCQUFBO3dCQUNMLHlCQUFDO29CQUFELENBUEEsQUFPQyxDQVBnQyxrQkFBUSxHQU94QztvQkFFRCw4R0FBOEc7b0JBQzlHLG1FQUFtRTtvQkFFbkUsSUFBSSxrQkFBa0IsR0FBdUIsSUFBSSxrQkFBa0IsQ0FBQyxDQUFDLEVBQUUsR0FBRyxFQUFFLFdBQVcsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQyxDQUFDO29CQUMzRyx5QkFBZSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsUUFBUSxHQUFHLGtCQUFrQixDQUFDO29CQUVoRSxPQUFPLENBQUMsR0FBRyxDQUFDLGtCQUFrQixDQUFDLENBQUM7b0JBRWhDLE1BQU0sQ0FBQyxrQkFBa0IsQ0FBQyxRQUFRLENBQUMsQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUM7Z0JBRTNELENBQUMsQ0FBQyxDQUFDO1lBQ1AsQ0FBQyxDQUFDLENBQUMiLCJmaWxlIjoic3BlYy9TZWN1cml0eUNvbnRleHQuc3BlYy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9Jy4uLy4uL3R5cGluZ3MvbWFpbi5kLnRzJyAvPlxyXG5pbXBvcnQgU2VjdXJpdHlDb250ZXh0IGZyb20gJy4uL3NyYy9TZWN1cml0eUNvbnRleHQnO1xyXG5pbXBvcnQgSWRlbnRpdHkgZnJvbSAnLi4vc3JjL0lkZW50aXRpZXMvSWRlbnRpdHknO1xyXG4vL2ltcG9ydCB7SWRlbnRpdHlGYWN0b3J5fSBmcm9tICcuLi9zcmMvSWRlbnRpdGllcy9JZGVudGl0eUZhY3RvcnknO1xyXG5pbXBvcnQgU2VjdXJpdHlDb250ZXh0RW5jb2RlZFRva2VuSW5pdGlhbGl6ZXIgZnJvbSAnLi4vc3JjL1NlY3VyaXR5Q29udGV4dEVuY29kZWRUb2tlbkluaXRpYWxpemVyJztcclxuXHJcbmRlc2NyaWJlKCdTZWN1cml0eUNvbnRleHQnLCAoKSA9PiB7XHJcbiAgICBcclxuICAgIGNvbnN0IGFjY2Vzc1Rva2VuOnN0cmluZyA9IFwiZXlKMGVYQWlPaUpLVjFRaUxDSmhiR2NpT2lKU1V6STFOaUlzSW10cFpDSTZJbUV6Y2sxVlowMUdkamwwVUdOc1RHRTJlVVl6ZWtGclpuRjFSU0lzSW5nMWRDSTZJbUV6Y2sxVlowMUdkamwwVUdOc1RHRTJlVVl6ZWtGclpuRjFSU0o5LmV5SnBjM01pT2lKb2RIUndjem92TDNCcWJYUnpkSE12SWl3aVlYVmtJam9pYUhSMGNITTZMeTl3YW0xMGMzUnpMM0psYzI5MWNtTmxjeUlzSW1WNGNDSTZNVFEyTVRnNE5qSXpOU3dpYm1KbUlqb3hORFl4T0RneU5qTTFMQ0pqYkdsbGJuUmZhV1FpT2lJeU16Z3dJaXdpYzJOdmNHVWlPbHNpYjNCbGJtbGtJaXdpY0hKdlptbHNaU0lzSW1WdFlXbHNJaXdpY0dwdGRGOXdjbTltYVd4bElpd2ljR1Z5YldsemMyRnZYekl6T0RBaVhTd2ljM1ZpSWpvaU1UWTRORE1pTENKaGRYUm9YM1JwYldVaU9qRTBOakV4TmpRNU16SXNJbWxrY0NJNkltbGtjM0oySWl3aWNHVnliV2x6YzJGdmZESXpPREE2UkdGemFHSnZZWEprSWpvaVFXTmxjM052SWl3aWNHVnliV2x6YzJGdmZESXpPREE2UkdGemFHSnZZWEprTGtkeVlXWnBZMjl6SWpvaVFXTmxjM052SWl3aWNHVnliV2x6YzJGdmZESXpPREE2UkdGemFHSnZZWEprTGtkeVlXWnBZMjl6TGtScGRtVnljMjl6SWpvaVFXTmxjM052SWl3aWNHVnliV2x6YzJGdmZESXpPREE2UkdGemFHSnZZWEprTGtkeVlXWnBZMjl6TGxOdlluSmxJam9pUVdObGMzTnZJaXdpY0dWeWJXbHpjMkZ2ZkRJek9EQTZSR0Z6YUdKdllYSmtMbEpsYkdGMGIzSnBieTVTWld4aGRHOXlhVzlEY21saFkyRnZJam9pUVdObGMzTnZJaXdpY0dWeWJXbHpjMkZ2ZkRJek9EQTZSR0Z6YUdKdllYSmtMbEpsYkdGMGIzSnBiM011VW1Wc1lYUnZjbWx2UVdObGMzTnZjeUk2V3lKQlkyVnpjMjhpTENKQmJIUmxjbUZ5SWl3aVJYaGpiSFZwY2lJc0lrNXZkbThpWFN3aWNHVnliV2x6YzJGdmZESXpPREE2U0c5dFpTSTZJa0ZqWlhOemJ5SXNJbkJsY20xcGMzTmhiM3d5TXpnd09rNXZkR2xqYVdGeklqb2lRV05sYzNOdklpd2ljR1Z5YldsemMyRnZmREl6T0RBNlVtVnNZWFJ2Y21sdmN5STZJa0ZqWlhOemJ5SXNJbUZ0Y2lJNld5SndZWE56ZDI5eVpDSmRmUS5FZy1iZFBBSEtNSURsVk1pR05KeEVKOXpxdGgyVW1VLWswRWsxQkl0aEM2V0tuZnlGT1E3RVFYSWJRR0JyTGhtNENIcl9zaXdyZ1RoQUw1TnEzR0pBbzBfd3hmamdkZ3Q5NjVGSFpMTzBYYS1RUlR2Zldkd0NVN19qSFlqbHd1eUo4SURpRXBRZjZ5NmVlVUlNeFJJMEpaYS1hSXJ0NU10TUNyTU1lY1RkVVJYRjkxYlhCRmROREpTR0xwcXJmNjg3SHV6VUNIcnJ6bkJyNndPLTUtNVkyNHJucFRiRWNsUzlLREpZdVRab0JRQTYtVGtjeV9YQkhnNGMxd2h3d09SZjlOZnYxYzhfVjZaak1MMWVpcWRsSzdNRGpxbXNaYkFaa1Njckp6Wm14cG9CTWt2QU1ESWhrbUI4WlZzR2tyWUlDcXRyQVI2Qkl1VGsyYUszejhsb3dcIjtcclxuICAgIFxyXG4gICAgICAgIC8vY29uc3QgYWNjZXNzVG9rZW5KU09OOmFueSA9IEpTT04ucGFyc2UoYHtcImlzc1wiOlwiaHR0cHM6Ly9wam10c3RzL1wiLFwiYXVkXCI6XCJodHRwczovL3BqbXRzdHMvcmVzb3VyY2VzXCIsXCJleHBcIjoxNDYyNDAzNTgyLFwibmJmXCI6MTQ2MjM5OTk4MixcImNsaWVudF9pZFwiOlwiMjM4MFwiLFwic2NvcGVcIjpbXCJvcGVuaWRcIixcInByb2ZpbGVcIixcInBqbXRfcHJvZmlsZVwiLFwiZW1haWxcIixcInBlcm1pc3Nhb18yMzgwXCJdLFwic3ViXCI6XCIxNjg0M1wiLFwiYXV0aF90aW1lXCI6MTQ2MjM5NzA0MixcImlkcFwiOlwiaWRzcnZcIixcInBlcm1pc3Nhb3wyMzgwOkRhc2hib2FyZFwiOlwiQWNlc3NvXCIsXCJwZXJtaXNzYW98MjM4MDpEYXNoYm9hcmQuR3JhZmljb3NcIjpcIkFjZXNzb1wiLFwicGVybWlzc2FvfDIzODA6RGFzaGJvYXJkLkdyYWZpY29zLkRpdmVyc29zXCI6XCJBY2Vzc29cIixcInBlcm1pc3Nhb3wyMzgwOkRhc2hib2FyZC5HcmFmaWNvcy5Tb2JyZVwiOlwiQWNlc3NvXCIsXCJwZXJtaXNzYW98MjM4MDpEYXNoYm9hcmQuUmVsYXRvcmlvLlJlbGF0b3Jpb0NyaWFjYW9cIjpcIkFjZXNzb1wiLFwicGVybWlzc2FvfDIzODA6RGFzaGJvYXJkLlJlbGF0b3Jpb3MuUmVsYXRvcmlvQWNlc3Nvc1wiOltcIkFjZXNzb1wiLFwiQWx0ZXJhclwiLFwiRXhjbHVpclwiLFwiTm92b1wiXSxcInBlcm1pc3Nhb3wyMzgwOkhvbWVcIjpcIkFjZXNzb1wiLFwicGVybWlzc2FvfDIzODA6Tm90aWNpYXNcIjpcIkFjZXNzb1wiLFwicGVybWlzc2FvfDIzODA6UmVsYXRvcmlvc1wiOlwiQWNlc3NvXCIsXCJhbXJcIjpbXCJwYXNzd29yZFwiXX1gKTtcclxuXHJcbiAgICBcclxuICAgIGNvbnN0IGlkZW50aXR5VG9rZW46c3RyaW5nID0gXCJleUowZVhBaU9pSktWMVFpTENKaGJHY2lPaUpTVXpJMU5pSXNJbXRwWkNJNkltRXpjazFWWjAxR2RqbDBVR05zVEdFMmVVWXpla0ZyWm5GMVJTSXNJbmcxZENJNkltRXpjazFWWjAxR2RqbDBVR05zVEdFMmVVWXpla0ZyWm5GMVJTSjkuZXlKcGMzTWlPaUpvZEhSd2N6b3ZMM0JxYlhSemRITXZJaXdpWVhWa0lqb2lNak00TUNJc0ltVjRjQ0k2TVRRMk1UZzRNamt6TlN3aWJtSm1Jam94TkRZeE9EZ3lOak0xTENKdWIyNWpaU0k2SWpFeU1qTXdNakEyTlRVNU5Ea3lNRGdpTENKcFlYUWlPakUwTmpFNE9ESTJNelVzSW1GMFgyaGhjMmdpT2lJemVWOWlTaTFvWkVaaU1qRTNWSE5wUVVWcFZuWjNJaXdpWTE5b1lYTm9Jam9pYkdoTVJERk9hVE5rY21zMGFFSktZWEJRUlVwYVFTSXNJbk5wWkNJNklqTmtNR1F6TldZeE5HRmpZV1EzTXpFeU0yRTJZMkZtTUdVNU5UWTVOR0l6SWl3aWMzVmlJam9pTVRZNE5ETWlMQ0poZFhSb1gzUnBiV1VpT2pFME5qRXhOalE1TXpJc0ltbGtjQ0k2SW1sa2MzSjJJaXdpWVcxeUlqcGJJbkJoYzNOM2IzSmtJbDE5LmhTOXZGR2NVcTZqM0NCUnNVRG0yUkcwend5TmJkUmlqTjFMX2Y3RW1YNGQ1bzhXeGg5UmFXeFBtWVVTQUd0MjExbHJucDFXMHptN0hmV3FPdTNzekpuaENXS2ZYX1A5Q1l1Yy0zTnlXWHhMOWlNWk0wN2x6d2V1bkplWXJXTTk5S0NXVDlpbF9wdFIzY3ZOQkVaUEJCSEJtelE1RVBiSHFNZ2EzNVUzVTBySFR1QzExMzRxdkRGRS0yWW9HeU5YeFA1S0QtcHlWbHgwaFBYT3Nmdjl4WWZLcjlDMzFlRU1xeXlhdlpXcG1pSDhZd3oxdmxKVE1kWDZZOUdtNzU5OU9qcWU2Nm1SQWFEWDdfcmY4a2VjZ3ZrU1pEMHVvekhQR0lYLVk4T1JQUzgzQUhYVE9GT0FYb08zaHZ4bkpKNmlOMW9WSlN6V1ZzSTU5VkZidk1JYXdDd1wiO1xyXG4gICAgXHJcbiAgICBcclxuICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgICAgU2VjdXJpdHlDb250ZXh0LlJlc2V0KCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnSW5pdCBzaG91bGQgaW5zdGFudGlhdGUgYSBVc2VyJywgKCkgPT4ge1xyXG4gICAgXHJcbiAgICAgICAgbGV0IHNlY3VyaXR5Q29udGV4dEluaXRpYWxpemVyID0gbmV3IFNlY3VyaXR5Q29udGV4dEVuY29kZWRUb2tlbkluaXRpYWxpemVyKFthY2Nlc3NUb2tlbiwgaWRlbnRpdHlUb2tlbl0pO1xyXG4gICAgICAgIFNlY3VyaXR5Q29udGV4dC5DdXJyZW50LkluaXQoc2VjdXJpdHlDb250ZXh0SW5pdGlhbGl6ZXIpO1xyXG4gICAgXHJcbiAgICAgICAgLy9TZWN1cml0eUNvbnRleHQuQ3VycmVudC5Vc2VyLnBlcm1pc3NvZXMuZmlsdGVyKChwZXJtaXNzYW8pID0+IHBlcm1pc3Nhby5wZXJtaXNzb2VzLnNvbWUoKHBlcm0pID0+IHBlcm0gPT0gXCJcIikpO1xyXG4gICAgXHJcbiAgICAgICAgZXhwZWN0KFNlY3VyaXR5Q29udGV4dC5DdXJyZW50LlByaW5jaXBhbCkudG9CZURlZmluZWQoKTtcclxuICAgIFxyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIGl0KCdJbml0IHNob3VsZCBoYXZlIGEgVXNlciBhdXRoZW50aWNhdGVkJywgKCkgPT4ge1xyXG4gICAgICAgIFxyXG4gICAgICAgIGxldCBzZWN1cml0eUNvbnRleHRJbml0aWFsaXplciA9IG5ldyBTZWN1cml0eUNvbnRleHRFbmNvZGVkVG9rZW5Jbml0aWFsaXplcihbYWNjZXNzVG9rZW4sIGlkZW50aXR5VG9rZW5dKTtcclxuICAgICAgICBTZWN1cml0eUNvbnRleHQuQ3VycmVudC5Jbml0KHNlY3VyaXR5Q29udGV4dEluaXRpYWxpemVyKTtcclxuICAgICAgICBcclxuICAgICAgICBleHBlY3QoU2VjdXJpdHlDb250ZXh0LkN1cnJlbnQuUHJpbmNpcGFsLklzQXV0aGVudGljYXRlZCkudG9CZVRydXRoeSgpO1xyXG4gICAgXHJcbiAgICB9KTtcclxuICAgIFxyXG4gICAgXHJcbiAgICBpdCgnVXNlciBzaG91bGQgaGF2ZSBjbGllbnRfaWQnLCAoKSA9PiB7XHJcbiAgICBcclxuICAgICAgICBsZXQgc2VjdXJpdHlDb250ZXh0SW5pdGlhbGl6ZXIgPSBuZXcgU2VjdXJpdHlDb250ZXh0RW5jb2RlZFRva2VuSW5pdGlhbGl6ZXIoW2FjY2Vzc1Rva2VuLCBpZGVudGl0eVRva2VuXSk7XHJcbiAgICAgICAgU2VjdXJpdHlDb250ZXh0LkN1cnJlbnQuSW5pdChzZWN1cml0eUNvbnRleHRJbml0aWFsaXplcik7XHJcbiAgICBcclxuICAgICAgICBsZXQgY2xpZW50X2lkID0gKDxJZGVudGl0eT5TZWN1cml0eUNvbnRleHQuQ3VycmVudC5QcmluY2lwYWwuSWRlbnRpdHkpLmZpbmRGaXJzdDxzdHJpbmc+KCdjbGllbnRfaWQnKTtcclxuICAgIFxyXG4gICAgICAgIGV4cGVjdChjbGllbnRfaWQpLnRvQmUoJzIzODAnKTtcclxuICAgICAgICBcclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICBpdCgnVXNlciBzaG91bGQgbm90IGJlIGF1dGhlbnRpY2F0ZWQnLCAoKSA9PiB7XHJcbiAgICAgICAgXHJcbiAgICAgICAgZXhwZWN0KFNlY3VyaXR5Q29udGV4dC5DdXJyZW50LlByaW5jaXBhbC5Jc0F1dGhlbnRpY2F0ZWQpLnRvQmUoZmFsc2UpO1xyXG4gICAgXHJcbiAgICB9KTtcclxuICAgIFxyXG4gICAgXHJcbiAgICBpdCgnU2hvdWxkIGxldCBhIEN1c3RvbWl6ZWQgSWRlbnRpdHkgYmUgc2V0JywgKCkgPT4ge1xyXG4gICAgICAgIFxyXG4gICAgICAgIGNsYXNzIElkZW50aXR5Q3VzdG9taXplZCBleHRlbmRzIElkZW50aXR5XHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBwdWJsaWMgZ2V0IENsaWVudElkKCkgOiBzdHJpbmcgXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGxldCB2YWx1ZSA9IHRoaXMuZmluZEZpcnN0PHN0cmluZz4oJ2NsaWVudF9pZCcpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIGxldCBjdXN0b21pemVkSWRlbnRpdHkgOklkZW50aXR5Q3VzdG9taXplZCA9IElkZW50aXR5RmFjdG9yeS5DcmVhdGUoSWRlbnRpdHlDdXN0b21pemVkLCBbYWNjZXNzVG9rZW5KU09OXSk7XHJcbiAgICAgICAgLy8gU2VjdXJpdHlDb250ZXh0LkN1cnJlbnQuUHJpbmNpcGFsLklkZW50aXR5ID0gY3VzdG9taXplZElkZW50aXR5O1xyXG4gICAgICAgIFxyXG4gICAgICAgIGxldCBjdXN0b21pemVkSWRlbnRpdHkgOklkZW50aXR5Q3VzdG9taXplZCA9IG5ldyBJZGVudGl0eUN1c3RvbWl6ZWQoW3sga2V5OiAnY2xpZW50X2lkJywgdmFsdWU6ICcyMzgwJyB9XSk7XHJcbiAgICAgICAgU2VjdXJpdHlDb250ZXh0LkN1cnJlbnQuUHJpbmNpcGFsLklkZW50aXR5ID0gY3VzdG9taXplZElkZW50aXR5O1xyXG4gICAgICAgIFxyXG4gICAgICAgIGNvbnNvbGUubG9nKGN1c3RvbWl6ZWRJZGVudGl0eSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgZXhwZWN0KGN1c3RvbWl6ZWRJZGVudGl0eS5DbGllbnRJZCkudG9CZVRydXRoeSgnMjM4MCcpO1xyXG4gICAgXHJcbiAgICB9KTtcclxufSk7XHJcbiJdfQ==
